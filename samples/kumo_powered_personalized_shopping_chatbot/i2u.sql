CREATE OR REPLACE CORTEX SEARCH SERVICE KUMO_CHATBOT_NAISHA.PUBLIC.item_to_user_service
ON search_text
ATTRIBUTES ENTITY_TYPE, CUSTOMER_ID
WAREHOUSE = WAREHOUSE_SMALL
TARGET_LAG = '1 hour'
AS
    -- Search predictions from ITEM_TO_USER_PREDICTIONS_ENRICHED
    SELECT
        'PREDICTIONS' AS ENTITY_TYPE,
        CUSTOMER_ID,
        PREDICTIONS AS search_text
    FROM
        KUMO_CHATBOT_NAISHA.PUBLIC.ITEM_TO_USER_PREDICTIONS_LESS

    UNION ALL

    -- Search customer info from CUSTOMER_INFO table
    SELECT
        'CUSTOMER_INFO' AS ENTITY_TYPE,
        CUSTOMER_ID,
        CUSTOMER_INFO AS search_text
    FROM
        KUMO_CHATBOT_NAISHA.PUBLIC.CUSTOMER_INFO;