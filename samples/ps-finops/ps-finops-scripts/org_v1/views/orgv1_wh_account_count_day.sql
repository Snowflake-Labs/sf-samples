USE ROLE <% ctx.env.finops_db_admin_role%>;
USE DATABASE <% ctx.env.finops_acct_db %>;
USE SCHEMA <% ctx.env.finops_acct_schema %>;
CREATE OR REPLACE VIEW ORGV1_WH_ACCOUNT_COUNT_DAY COMMENT = 'Title: Organizational count of Distinct WH by Account per day. Description: Organizational count of distinct WH in account per day.' AS
SELECT DATE_TRUNC('DAY', START_TIME) AS DAY,
   ACCOUNT_NAME,
   CONCAT_WS('-', REGION, ACCOUNT_NAME) AS REGION_ACCOUNT_NAME,
   CONCAT_WS('-', REGION, ACCOUNT_NAME, WAREHOUSE_NAME) AS REGION_WH_NAME,
	APPROX_COUNT_DISTINCT(WAREHOUSE_ID) AS WH_COUNT -- APPROXIMATE COUNT OF WAREHOUSES
FROM SNOWFLAKE.ORGANIZATION_USAGE.WAREHOUSE_METERING_HISTORY
GROUP BY ALL;
